"use strict";var oCanvas,curObj,dialog,aCanvas=Array(100),nCanvasNo=0,nCurPageNo=0,nPage=0,bSave=!1,nCurZoom=null,_clipboard=null,isFirst=!0,isRemoveHistory=!1,isFontLoaded=!1,page_ing=!1,loc_page=1,isLoadAjaxEnd=!1,nHistory=-1,aHistory=[],aOriginal=[],downloadInterval=null,completeRemakePage=!1,save_ing=!1;$(window).bind("beforeunload",function(a){if(bSave)return"창을 닫으실래요?"}),$(window).on("copy",function(a){}),$(window).on("paste",function(a){});var objControlsTxt=Object({bl:!0,br:!0,mb:!1,ml:!0,mr:!0,mt:!1,tl:!0,tr:!0,mtr:!0}),objControlsImg=Object({bl:!0,br:!0,mb:!0,ml:!0,mr:!0,mt:!0,tl:!0,tr:!0,mtr:!0});function save_log(a,t=0,e=0,n=0){$.ajax({url:"/Common/saveLog/",data:{type:a,tid:t,mid:e,cid:n},method:"post",dataType:"json"})}function save_process(a=""){if(!0===save_ing)return!1;if(save_ing=!0,"bg-save"===a?$("#bg_save").val("Y"):$("#bg_save").val("N"),"my"===$("#save_type").val()){var t=!0;if($.ajax({url:"/Canvas/CheckModified/",data:{_csrf:$('input[name="_csrf"]').val(),my_canvas_id:$("#my_canvas_id").val(),last_modified:$("#last_modified").val()},method:"post",dataType:"json",async:!1,success:function(a){!1===(t=a.success)&&showModifiedError(a.data)}}),!1===t)return save_ing=!1,!1}if(""===$('input[name="top_title"]').val())return alert("제목을 입력하세요."),$('input[name="top_title"]').focus(),save_ing=!1,!1;if(""==a&&!confirm("저장하시겠습니까?"))return save_ing=!1,!1;""==a&&loader("저장 중 입니다."),bSave=!1,$('input[name="title"]').val($('input[name="top_title"]').val());var e=nCurZoom;procZoom(1,!0);var n=[],o=[],i=0,s=!0;if($(".canvas-page").each(function(a,t){var e=$(this).data("idx");if(parseInt(e)>=0&&null!=aCanvas[e]){var r=aCanvas[e].toDatalessJSON();r.objects.length>0&&(s=!1);var l=JSON.stringify(r);n.push(l),o.push(aCanvas[e].toDataURL()),i++}}),!0===s&&"bg-save"===a)return procZoom(e),save_ing=!1,!1;$("#thumb_file").val(JSON.stringify(o)),$("#blob_data").val(JSON.stringify(n)),$("#page").val(i),$("#rotate").val($(".emRotate.active").data("val")),procZoom(e),$("#frmSave").submit()}function resetAll(){aCanvas=Array(100),nCanvasNo=-1,nCurPageNo=0,nHistory=-1,aHistory=[],nPage=0,$(".canvas-wrap").html("")}function applyDrag(){$(".objItemImg").draggable({revert:!0,appendTo:"body",containment:"window",revertDuration:0,helper:"clone",zIndex:99999,start:function(a,t){if("Y"===$(this).data("paid_yn")&&"N"===paid_user)return paid_modal(),!1;$(".dummy_img").attr("src",$(this).data("org_file"))}})}function rgb2hex(a){if(-1==a.search("rgb"))return a;function t(a){return("0"+parseInt(a).toString(16)).slice(-2)}return"#"+t((a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/))[1])+t(a[2])+t(a[3])}function onSelected(a){chkObject()}function onUpdate(){bSave=!0,$(".btnSave").html("저장하기").removeClass("disabled"),addHistory(),chkObject()}function Init(){applyDrag(),InitCanvas(0),setCanvas(0);var a="";a="my"===$("#loadType").val()?$("#nDataIdx").val():$("#nLoadIdx").val(),LoadPage($("#loadType").val(),a,!0)}function setCanvas(a){oCanvas=aCanvas[a],nCurPageNo=a;for(var t=0;t<aCanvas.length;t++)null!=aCanvas[t]&&(aCanvas[t].discardActiveObject(),aCanvas[t].renderAll())}function InitCanvas(a,t){var e=new fabric.Canvas("cvBase"+a,{preserveObjectStacking:!0});e.setWidth($(".wrapCanvas").width()),e.setHeight($(".wrapCanvas").height()),fabric.util.object.extend(fabric.Textbox.prototype,{_initDimensions:function(a){!this.__skipDimension&&(a||(a=fabric.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(),this.dynamicMinWidth!=this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(a))}});var n=document.createElement("img");function o(a,t,e,o,i){var s=this.cornerSize;a.save(),a.translate(t,e),a.rotate(fabric.util.degreesToRadians(i.angle)),a.drawImage(n,-s/2,-s/2,s,s),a.restore()}n.src="/images/easycanvas/easycv_icon_rotate.png",fabric.Object.prototype.controls.mtr=new fabric.Control({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",actionHandler:fabric.controlsUtils.rotationWithSnapping,actionName:"rotate",render:o,cornerSize:34,withConnection:!1}),fabric.Textbox.prototype.controls.mtr=new fabric.Control({x:0,y:-.5,offsetY:-20,cursorStyle:"crosshair",actionHandler:fabric.controlsUtils.rotationWithSnapping,actionName:"rotate",render:o,cornerSize:34,withConnection:!1});var i=document.createElement("img");function s(a,t){var e=t.target,n=e.canvas;n.remove(e),n.requestRenderAll()}function r(a,t,e,n,o){var s=this.cornerSize;a.save(),a.translate(t,e),a.rotate(fabric.util.degreesToRadians(o.angle)),a.drawImage(i,-s/2,-s/2,s,s),a.restore()}i.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E",fabric.Textbox.prototype.controls.deleteControl=new fabric.Control({x:.5,y:-.5,offsetY:-20,cursorStyle:"pointer",mouseUpHandler:s,render:r,cornerSize:24}),fabric.Object.prototype.controls.deleteControl=new fabric.Control({x:.5,y:-.5,offsetY:-20,cursorStyle:"pointer",mouseUpHandler:s,render:r,cornerSize:24}),fabric.Object.prototype.borderColor="black",fabric.Object.prototype.cornerColor="black",fabric.Object.prototype.transparentCorners=!1,fabric.Object.prototype.cornerSize=15,fabric.Object.prototype.cornerStyle="circle",fabric.Object.prototype.fireRightClick=!0,fabric.Object.prototype.stopContextMenu=!0,e.on({"object:selected":function(a){onSelected(a)},"object:modified":function(a){isRemoveHistory=!0},"object:moving":function(a){chkObject()},"object:scaling":function(a){chkObject()},"selection:updated":function(a){onSelected(a)},"selection:cleared":function(a){chkObject()},"object:rotated":function(a){onUpdate()},"object:scaled":function(a){setStrokeWidth(),onUpdate()},"object:moved":function(a){onUpdate()},"selection:created":function(a){onSelected(a)}}),""!=t&&e.loadFromJSON(t,function(){e.renderAll.bind(e),0==a&&addHistory(),procZoom(nCurZoom)},function(a,t){fabric.util.clearFabricFontCache(),oCanvas.renderAll(),oCanvas.requestRenderAll()}),aCanvas[a]=e,droppable(a),!0===isFirst&&(null==nCurZoom?procZoom(init_zoom):procZoom(nCurZoom),isFirst=!1)}function droppable(a){$("#cvBase"+a).droppable({drop:function(a,t){var e=t.draggable;if(e.hasClass("objItemImg")){var n=($(".canvas-container").width()-$(".canvas-wrap").width())/2+$(".left-menu").width(),o=$("header").height()+parseInt($(".canvas-page").css("marginTop"))+$(".contents-wrap-header").height(),i=t.offset.left-n,s=t.offset.top-o;addImage("object",e.get(0),i,s)}}})}function LoadPage(a,t,e){if(""===t)return!1;$.ajax({url:"/Canvas/getCvsData",type:"post",data:{loadType:a,nLoadIdx:t,_csrf:$('input[name="_csrf"]').val()},dataType:"json",success:function(n){$('input[name="_csrf"]').val(n.csrf),n.emRotate&&$('.emRotate[data-val="'+n.emRotate+'"]').click(),"Y"===n.reject?paid_modal():!0===n.success&&""!==n.blob&&(e?("my"===a?save_log("V",0,t):"template"===a&&save_log("V",t),reMakePage(n.blob)):setupPage(n.blob))}})}function setupPage(a){for(var t=a.split("||"),e=-1,n=aCanvas.length,o=0;o<n;o++)void 0!==aCanvas[o]&&aCanvas[o].toDatalessJSON().objects.length>0&&(e=o);for(var i=e+1;i<n;i++){var s=i,r=$(".canvas-page[data-idx='"+s+"']");if(r.length>0&&(r.remove(),aCanvas[s]=null,nCanvasNo--,$(".canvas-wrap .canvas-page").length>0)){var l=[];$.each(aCanvas,function(a,t){null!=t&&l.push(t)}),s=l.length-1,aCanvas=l}}resetPageNo();for(var c=0;c<t.length;c++)addPage(JSON.parse(t[c])),aCanvas[c].renderAll()}function reMakePage(a){if(resetAll(),""==a||null==a){addPage();return}for(var t=a.split("||"),e=0;e<t.length;e++)aOriginal[e]=t[e],addPage(JSON.parse(t[e])),aCanvas[e].renderAll();completeRemakePage=!0}function addHistory(){if(oCanvas.toDatalessJSON().objects.length>0){nHistory++;var a=!1;$.each(aHistory,function(t,e){e.nCanvasNo===nCurPageNo&&(a=!0)}),!a&&(aHistory[nHistory]={},aHistory[nHistory].nCanvasNo=parseInt(nCurPageNo),aHistory[nHistory].sCanvasData=void 0===aOriginal[nCurPageNo]?JSON.stringify({objects:[],version:fabric.version}):aOriginal[nCurPageNo],nHistory++);var t=JSON.stringify(oCanvas.toDatalessJSON());aHistory[nHistory]={},aHistory[nHistory].nCanvasNo=parseInt(nCurPageNo),aHistory[nHistory].sCanvasData=t}}function unDo(){if(aHistory.length>0){--nHistory<0&&(nHistory=0);var a=aHistory[nHistory].nCanvasNo;void 0!==aCanvas[a]&&(mvScroll(a),aCanvas[a].loadFromJSON(JSON.parse(aHistory[nHistory].sCanvasData),function(t){aCanvas[a].renderAll()}))}}function reDo(){if(nHistory<aHistory.length-1){var a=aHistory[++nHistory].nCanvasNo;null!=aCanvas[a]&&(mvScroll(a),aCanvas[a].loadFromJSON(JSON.parse(aHistory[nHistory].sCanvasData),function(t){aCanvas[a].renderAll()}))}}function procZoom(a,t=!1){var e=(nCurZoom=parseFloat(a))/2;!0===t&&(e=nCurZoom),$(".canvas-add-page").parent().css("width",nCanvasWidth*e+"px"),$("input.btnZoomScale").val(100*nCurZoom),$(".wrapCanvas").width(nCanvasWidth*e),$(".wrapCanvas").height(nCanvasHeight*e);try{for(var n=0;n<aCanvas.length;n++)aCanvas[n].setZoom(e),aCanvas[n].setWidth($(".wrapCanvas").width()),aCanvas[n].setHeight($(".wrapCanvas").height())}catch(o){}}function addImageMy(a,t){$('.icon-menu li div[data-val="_upload"]').click()}function addImage(a,t,e,n){var o=new Image;o.src=$(t).data("org_file"),e=void 0===e||null==e?oCanvas.width/2-parseInt($(t).data("w"))/2:e,n=void 0===n||null==n?oCanvas.height/2-parseInt($(t).data("h"))/2:n,e=e<1?10:e,n=n<1?10:n;var i=Math.round(parseInt($(t).data("w"))*nCurZoom*1e12)/1e12;i=i>oCanvas.width?oCanvas.width/2:i;var s=Math.round(parseInt($(t).data("h"))*nCurZoom*1e12)/1e12;if(s=s>oCanvas.height?oCanvas.height/2:s,"svg"==$(t).attr("t"))fabric.loadSVGFromURL($(t).attr("src"),function(a,t){var o=fabric.util.groupSVGElements(a,t);o.left=e,o.top=n,o.scaleToWidth(100),o.scaleToHeight(100),oCanvas.add(o),oCanvas.setActiveObject(o),oCanvas.renderAll()});else{var r=new fabric.Image(o,{left:e,top:n,angle:0,opacity:1,rotatingPointOffset:10});r.scaleToWidth(i),r.scaleToHeight(s),r.setControlsVisibility(objControlsImg),(r.scaleX<.1||isNaN(r.scaleX))&&(r.scaleX=nCurZoom,r.scaleY=nCurZoom),o.onload=function(){oCanvas.add(r).setActiveObject(r)}}oCanvas.renderAll(),onUpdate()}function addTxt(a,t){$("#cvBase"+nCanvasNo).offset();var a="undefined"==a||null==a?oCanvas.width/2-100:a,t="undefined"==t||null==t?oCanvas.height/2-100:t+50,e=$(".objFF").val(),n=new fabric.Textbox("내용을 입력하세요",{left:a,top:t,width:300,textAlign:"center",editingBorderColor:"#777",fontFamily:e,fontSize:60,padding:7});n.setControlsVisibility(objControlsTxt),oCanvas.add(n).setActiveObject(n),onUpdate()}function addPage(a){if($(".canvas-page").length>18){alert("페이지는 19개까지 추가가능합니다.");return}if(++nCanvasNo>99){alert("더 이상 페이지를 추가할 수 없습니다.");return}$(".canvas-page .canvas-add-page").remove();var t="";t+='<div class="canvas-page d-flex flex-column mt-3 position-relative" data-idx="'+nCanvasNo+'">',t+='		<div class="d-flex flex-row align-items-center justify-content-between mb-2 contents-wrap-header">',t+='			<div class="d-flex align-items-center justify-content-center" style="padding-bottom: 1px;">',t+='				<span style="width: 70px;">'+(parseInt(nCanvasNo)+1)+"</span>",t+="			</div>",t+='			<div class="icon-group d-flex flex-row">',t+='				<button class="btn btn-xs btnPageCopy" data-idx="'+nCanvasNo+'"><i class="fa-regular fa-copy"></i></button>',t+='				<button class="btn btn-xs mvScroll" data-act="up" data-idx="'+nCanvasNo+'"><i class="fa-solid fa-arrow-up"></i></button>',t+='				<button class="btn btn-xs mvScroll" data-act="down" data-idx="'+nCanvasNo+'"><i class="fa-solid fa-arrow-down"></i></button>',t+='				<button class="btn btn-xs btnPageDel" data-idx="'+nCanvasNo+'"> <i class="fa-solid fa-trash"></i> </button>',t+="			</div>",t+="		</div>",t+='		<div class="wrapCanvas mb-2" style="background-color: #fff;">',t+='			<canvas id="cvBase'+nCanvasNo+'" class="cvBase" title="'+nCanvasNo+'"></canvas>',t+="		</div>",t+="</div>",$(".canvas-wrap").append(t),InitCanvas(nCanvasNo,a),setCanvas(nCanvasNo),procZoom(nCurZoom),mvScroll(nCanvasNo),resetPageNo()}function mvScroll(a){if($('.canvas-page[data-idx="'+a+'"]').length>0){var t=parseInt($('.canvas-page[data-idx="'+a+'"]').offset().top,10),e=parseInt($(".canvas-scroll").scrollTop(),10);t-=82,$(".canvas-scroll").stop().animate({scrollTop:e+t},100,"swing")}}function resetPageNo(){$(".canvas-wrap .canvas-page").each(function(a,t){var e=a,n=$(this).data("idx");$(this).attr("data-idx",e).data("idx",e);var o="";o+='<span style="width: 70px;">'+(a+1)+"&nbsp;페이지</span>",$(this).find("div:eq(0) > div:eq(0)").html(o),$(this).find("div:eq(0) > div:eq(1) > button[data-idx]").attr("data-idx",e).data("idx",e),$(this).find("#cvBase"+n).attr("id","cvBase"+e).attr("title",e)})}function procCopy(a){var t="",e=!1;return window.getSelection&&(t=window.getSelection().toString()),t?e=!0:(oCanvas.getActiveObject().clone(function(a){a.lastModified=Date.now(),_clipboard=a}),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide()),e}function procPaste(a){try{_clipboard.clone(function(a){oCanvas.discardActiveObject(),a.set({left:a.left+50,top:a.top+50,evented:!0}),"activeSelection"===a.type?(a.canvas=oCanvas,a.forEachObject(function(a){oCanvas.add(a)}),a.setCoords()):oCanvas.add(a),_clipboard.top+=50,_clipboard.left+=50,oCanvas.setActiveObject(a),oCanvas.requestRenderAll()})}catch(t){}oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide()}function procDelete(){if((curObj=oCanvas.getActiveObjects()).length){if(curObj[0].isEditing)return!0;curObj&&(curObj.forEach(function(a){oCanvas.remove(a)}),oCanvas.discardActiveObject(),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide())}1===$(".canvas-page").length&&setCanvas(0)}function procForward(){(curObj=oCanvas.getActiveObjects()).length&&(curObj.forEach(function(a){oCanvas.bringForward(a)}),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide())}function procForwardFirst(){(curObj=oCanvas.getActiveObjects()).length&&(curObj.forEach(function(a){oCanvas.bringToFront(a)}),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide())}function procBackward(){(curObj=oCanvas.getActiveObjects()).length&&(curObj.forEach(function(a){oCanvas.sendBackwards(a)}),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide())}function procBackwardLast(){(curObj=oCanvas.getActiveObjects()).length&&(curObj.forEach(function(a){oCanvas.sendToBack(a)}),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide())}function procFlipX(){(curObj=oCanvas.getActiveObjects()).length&&(curObj[0].flipX?curObj[0].set({flipX:!1}):curObj[0].set({flipX:!0}),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide())}function procFlipY(){(curObj=oCanvas.getActiveObjects()).length&&(curObj[0].flipY?curObj[0].set({flipY:!1}):curObj[0].set({flipY:!0}),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide())}function procRotate(a){if((curObj=oCanvas.getActiveObjects()).length){var t=curObj[0].angle;curObj[0].rotate(t+a),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide()}}function procAlignLeft(){(curObj=oCanvas.getActiveObjects()).length&&(curObj[0].set({left:1}),curObj[0].setCoords(),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide())}function procAlignRight(){if((curObj=oCanvas.getActiveObjects()).length){var a=parseFloat(nCurZoom)/2;curObj[0].set({left:oCanvas.width/a-curObj[0].width*curObj[0].scaleX}),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide()}}function procAlignCenter(){if((curObj=oCanvas.getActiveObjects()).length){var a=parseFloat(nCurZoom)/2;curObj[0].set({left:oCanvas.width/a/2-curObj[0].width*curObj[0].scaleX/2}),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide()}}function procSetGroup(){oCanvas.getActiveObject()&&"activeSelection"===oCanvas.getActiveObject().type&&(oCanvas.getActiveObject().toGroup(),oCanvas.requestRenderAll(),onUpdate(),$(".objPopMenu").hide())}function procSetUnGroup(){oCanvas.getActiveObject()&&"group"===oCanvas.getActiveObject().type&&(oCanvas.getActiveObject().toActiveSelection(),oCanvas.requestRenderAll(),onUpdate(),$(".objPopMenu").hide())}function chkObject(){if(1===(curObj=oCanvas.getActiveObjects()).length){if(curObj[0]){if("textbox"==curObj[0].type){$(".objFSize").val(curObj[0].fontSize),$("#objCS").val(curObj[0].charSpacing),$("#objCSVal").html(curObj[0].charSpacing),$("#objLH").val(curObj[0].lineHeight),$("#objLHVal").html(curObj[0].lineHeight),$(".objFTA").removeClass("active"),$(".objFTA_"+curObj[0].textAlign).addClass("active"),"800"==curObj[0].fontWeight?$(".objFS[data-val='bold']").addClass("active"):$(".objFS[data-val='bold']").removeClass("active"),"italic"==curObj[0].fontStyle?$(".objFS[data-val='italic']").addClass("active"):$(".objFS[data-val='italic']").removeClass("active"),curObj[0].underline?$(".objFS[data-val='underline']").addClass("active"):$(".objFS[data-val='underline']").removeClass("active"),""==curObj[0].shadow||null==curObj[0].shadow?$(".objFS[data-val='shadow']").removeClass("active"):$(".objFS[data-val='shadow']").addClass("active"),$(".objFC").val(curObj[0].fill),$(".objFBC").val(curObj[0].textBackgroundColor),$(".objFF").val(curObj[0].fontFamily),curObj[0].setControlsVisibility(objControlsTxt);var a=$(".contents-menu-wrap");if($(".object-wrap").removeClass("d-flex").addClass("d-none"),a.addClass("d-flex").removeClass("d-none"),null!==curObj[0].stroke){var t=Math.floor(curObj[0].strokeWidth/curObj[0].scaleX*10);$('input[name="stroke-width-range"]').val(t),$('input[name="stroke-width"]').val(t),$('input[name="stroke-color"]').val(curObj[0].stroke),$("#active-stroke").prop("checked",!0)}var e=curObj[0].shadow;null!==e&&($('input[name="shadow-blur-range"]').val(e.blur),$('input[name="shadow-blur"]').val(e.blur),$('input[name="shadow-color"]').val(e.color),$('.shadow-direct li[data-y="'+e.offsetY+'"][data-x="'+e.offsetX+'"]').addClass("active"),$("#active-shadow").prop("checked",!0)),"_text"!=a.data("type")&&$('.icon-menu-wrap > ul > li > div[data-val="_text"]').click()}else $(".contents-menu-wrap").removeClass("d-flex").addClass("d-none"),$(".object-wrap").addClass("d-flex").removeClass("d-none")}}else $(".objFS , .objFTA").removeClass("active"),$(".objFC , .objFBC").val("#00000"),$(".objFSize").val(60),$("#objCS").val(0),$("#objLH").val(1.16),$(".contents-menu-wrap").addClass("d-flex").removeClass("d-none"),$(".object-wrap").removeClass("d-flex").addClass("d-none"),$('input[name="stroke-width-range"]').val(2),$('input[name="stroke-width"]').val(2),$('input[name="stroke-color"]').val("#fe7e8d"),$("#active-stroke").prop("checked",!1),$('input[name="shadow-blur-range"]').val(5),$('input[name="shadow-blur"]').val(5),$('input[name="shadow-color"]').val("#fe7e8d"),$(".shadow-direct li").removeClass("active"),$("#active-shadow").prop("checked",!1)}function setBackgroundImg(a){fabric.Image.fromURL(a,a=>{a.set({opacity:1,scaleX:nCanvasWidth/a.width,scaleY:nCanvasHeight/a.height}),oCanvas.setBackgroundImage(a,oCanvas.requestRenderAll.bind(oCanvas),{backgroundImageOpacity:1,backgroundImageStretch:!0}),onUpdate()})}function clearBackground(){let a=new fabric.Image("");oCanvas.setBackgroundImage(a,oCanvas.renderAll.bind(oCanvas)),oCanvas.setBackgroundColor("",oCanvas.renderAll.bind(oCanvas)),onUpdate()}function addRecentColor(a,t){var e,n;"bg"===a?n=$(".recent-bg-color"):"text"===a&&(n=$(".recent-text-color")),n.find("ul li").each(function(){t===rgb2hex($(this).css("backgroundColor"))&&$(this).remove()}),n.find("ul li").length>=7&&n.find("ul li:last-child").remove(),e='<li style="background-color:'+t+'" class="editor_palet_color objFC_p"></li>',n.find("ul").prepend(e),n.hasClass("d-none")&&n.toggleClass("d-none").toggleClass("d-flex")}function chkScroll(){var a=$(".emRotate.active").data("val"),t=300,e=$(".canvas-page"),n=$(".canvas-scroll");"P"===a&&(t=180),$("#emRotate").val(a),e.each(function(a){$(this).offset().top<t&&$(this).offset().top>-1*t&&parseInt(nCurPageNo,10)!==parseInt($(this).data("idx"),10)&&setCanvas($(this).data("idx"))});var o=Math.floor(n.scrollTop()+n.height()),i=0;n.find(" > div").each(function(){i+=Math.floor($(this).height())}),i<=o+1&&setCanvas(e.last().data("idx"))}function setBackgroundColor(a,t=!1){if(!0===t){let e=new fabric.Image("");$.each(aCanvas,function(t,n){void 0!==n&&(n.setBackgroundImage(e,n.renderAll.bind(n)),n.setBackgroundColor("",n.renderAll.bind(n)),n.setBackgroundColor(a,n.renderAll.bind(n)))})}else clearBackground(),oCanvas.setBackgroundColor(a,oCanvas.renderAll.bind(oCanvas));onUpdate()}function procAlignTop(){(curObj=oCanvas.getActiveObjects()).length&&(curObj[0].set({top:1}),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide())}function procAlignBottom(){(curObj=oCanvas.getActiveObjects()).length&&(curObj[0].set({left:oCanvas.height-curObj[0].height*curObj[0].scaleY-1}),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide())}function procAlignCenterAbsolute(){(curObj=oCanvas.getActiveObjects()).length&&(curObj[0].center(),oCanvas.renderAll(),onUpdate(),$(".objPopMenu").hide())}function showModifiedError(a){var t='<div class="save-caution-area">';t+='    <div class="save-caution-bg"></div>',t+='    <div class="save-caution-wrap">',t+='        <img src="/images/de_caution.png"  alt="caution-mark" />',t+="        <h3>저장할 수 없는 디자인입니다.</h3>",t+="        <p>"+a.username+" 님이 "+a.last_modified+"에 마지막으로 저장하였습니다.</p>",t+="        <p>동시에 편집할 경우 작업내역이 저장되지 않을 수 있습니다.</p>",t+='        <div class="button-wrap">',t+='            <button class="btn curr-copy" style="letter-spacing: -.1px">현재 작업으로 복사본 만들기</button>',t+='            <button class="btn load-recent-data">최신버전 불러오기</button>',t+="        </div>",t+="    </div>",t+="</div>",$("body").append(t)}function setContentsWrap(a){isLoadAjaxEnd=!1,loc_page=1;var t=$(".contents-menu-wrap"),e=$(".object-wrap");if(t.hasClass("d-none")&&e.hasClass("d-flex")&&t.data("type")===a)return t.addClass("d-flex").removeClass("d-none"),e.removeClass("d-flex").addClass("d-none"),!1;t.addClass("d-flex").removeClass("d-none"),e.removeClass("d-flex").addClass("d-none");var n='<div class="loader-wrap d-flex align-items-center justify-content-center flex-row py-5">';n+='    <div class="spinner-grow text-primary" role="status">',n+='        <span class="visually-hidden">Loading...</span>',n+="    </div>",n+='    <div class="ms-2"> 불러오는 중입니다. </div>',n+="</div>",t.html(n).data("type",a).attr("data-type",a),$.ajax({type:"post",url:"/Canvas/getContentsWrapPage",data:{m:"get_contents_wrap_page",type:a,_csrf:$('input[name="_csrf"]').val()},dataType:"html",success:function(a){$(".contents-menu-wrap").html(a)}}).done(function(){var a=$(".col-resize"),t=$(".left-menu");a.css("left",parseInt(t.width())),a.draggable({axis:"x",drag:function(a,e){e.position.left=parseInt(t.width())}}),applyDrag()})}function setSearchText(a,t){$('input[name="search-text"]').val(a),setTextCancelIcon(),getList()}function setTextCancelIcon(){""!==$('input[name="search-text"]').val()?$(".icon-text-cancel").show():$(".icon-text-cancel").hide()}function printSearchResult(a,t,e){let n="";var o="objItemImg";"_bg"===t?o="objBGImg":"_template"===t&&(o="objItemTemplate"),a.length<1&&$(".result-list-wrap div a").length<1?(n+='<div class="d-flex justify-content-center align-items-center">검색 결과가 없습니다.</div>',$(".result-list-wrap").html(n).show()):($.each(a,function(a,e){"_template"===t?(n+="<a>",n+='<img alt="" src="'+e.thumb_file+'" data-tid="'+e.template_id+'" data-paid_yn="'+e.paid_yn+'" class="'+o+' ui-draggable ui-draggable-handle canvas-img" data-idx="'+e.template_id+'" alt="'+e.title+'" />',"Y"===e.paid_yn&&"N"===paid_user&&(n+=' <span><img class="paid-mark position-absolute"  src="/img/paid_mark.png" alt="유료마크" /></span>'),n+="</a>"):-1>=e.save_file.indexOf("pdf")?(n+="<a>",n+='	<span class="d-flex justify-content-center h-100">',n+='		<img alt="" src="'+e.thumb_file+'"  data-cid="'+e.clip_id+'" data-paid_yn="'+e.paid_yn+'" data-org_file="'+e.save_file+'" class="'+o+' canvas-img" data-w="'+e.img_w+'" data-h="'+e.img_h+'" alt="'+e.title+'" />',"Y"===e.paid_yn&&"N"===paid_user&&(n+='		<span><img class="paid-mark position-absolute"  src="/img/paid_mark.png" alt="유료마크" /></span>'),n+="	</span>",n+="</a>"):console.log("pdf")}),!1===e?(n='<div class="justified-gallery">'+n+"</div>",$(".result-list-wrap").html(n).show(),$(".contents-menu-wrap .loader-wrap").toggleClass("d-none").toggleClass("d-flex"),setTimeout(function(){$(".justified-gallery").justifiedGallery({rowHeight:88,maxRowHeight:88,lastRow:"nojustify",border:0,margins:15})},300)):($(".result-list-wrap > div").append(n),setTimeout(function(){$(".justified-gallery").justifiedGallery("norewind")})),applyDrag())}function paid_modal(){var a=$("#alert-form"),t='<div class="modal-body text-center position-relative d-flex gap-2 flex-column align-items-center">';t+='	<button type="button" class="close btn fs-5 float-end position-absolute" style="top: 15px;;right: 15px;" data-dismiss="modal" aria-label="Close" onclick="$(\'#alert-form\').modal(\'hide\');">',t+='   	<i class="fa-solid fa-xmark"></i>',t+="	</button>",t+='   <h3><i class="fa-solid fa-crown" style="color: #FFD43B"></i> 유료회원 전용입니다. </h3>',t+="   <p>다양한 콘텐츠와 기능을 마음껏 이용해 보세요.</p>",t+='   <a role="button" target="_blank" href="/Payment/upsertForm" class="btn btn-black" style="width: 35%;">유료회원 가입하기</a>',t+="</div>",a.find(".modal-content").html(t),a.modal("show")}function mobile_modal(){var a=$("#alert-form"),t='<div class="modal-body text-center position-relative d-flex gap-2 flex-column align-items-center">';t+='	<button type="button" class="close btn fs-5 float-end position-absolute" style="top: 15px;;right: 15px;" data-dismiss="modal" aria-label="Close" onclick="$(\'#alert-form\').modal(\'hide\');">',t+='   	<i class="fa-solid fa-xmark"></i>',t+="	</button>",t+='   <h3><i class="fa-solid fa-circle-exclamation"></i>&nbsp;&nbsp;NOTICE&nbsp;&nbsp;<i class="fa-solid fa-circle-exclamation"></i></h3>',t+="   <p>PC 사용을 권장합니다.<br>모바일 버전에서 작업할 시,<br>오류가 발생할 수 있습니다.</p>",t+="</div>",a.find(".modal-content").html(t),a.modal("show")}function getList(){isLoadAjaxEnd=!1,loc_page=2;var a=$('input[name="search-text"]').val(),t=$('input[name="search-type"]');if(""!==a){if($('input[name="search-text-hidden"]').val(a),$(".contents-list-wrap").hide(),$(".contents-menu-wrap .loader-wrap").toggleClass("d-none").toggleClass("d-flex"),t.length<0)return alert("비정상적인 검색"),location.reload(),!1;var e=t.val();$.ajax({type:"post",url:"/Canvas/getSearchContents",data:{m:e,str:a},dataType:"json",success:function(a){printSearchResult(a.data,e,!1)}})}else $(".contents-list-wrap").show(),$(".result-list-wrap").hide()}function getLoadAjax(a){var t=$(".icon-menu li div.active").data("val"),e="",n=$('.contents-menu-wrap input[name="search-text-hidden"]');n.length>0&&(e=n.val());var o={page:loc_page,type:t,act:a,search_text:e};$.ajax({type:"post",url:"/Canvas/getLoadAjax",data:o,dataType:"json",async:!1,success:function(e){e.data.aList.length<per_page&&(isLoadAjaxEnd=!0),"category"===a?printAddListCategory(e.data.aList,t):printSearchResult(e.data.aList,t,!0)}}).done(function(){loc_page++,page_ing=!1})}function printAddListCategory(a,t){var e="",n="",o="objItemImg",i={rowHeight:88,lastRow:"nojustify",border:0,margins:15,maxRowsCount:1};"_bg"===t||"_clip"===t?$.each(a,function(a,i){e+='<div class="contents-list-wrap position-relative">',e+='    <p class="d-flex justify-content-between">'+i.title+'<span class="_more d-inline-block d-flex align-items-center text-primary" style="font-size: 13px;cursor: pointer" onclick="setSearchText(\''+i.title+"')\">더보기</span></p>",e+='    <div class="overflow-hidden">',e+='        <div class="image-list" style="overflow: hidden;width: 100vw">',e+='            <div class="image-list-inner justified-gallery editor_imglistall">',$.each(i.clips,function(a,i){0===a&&(n="active"),"_bg"===t&&(o="objBGImg"),e+='            <a class="'+n+' " style="min-width: 100px;max-width: 300px;overflow-x: hidden">',e+='				<span class="d-flex justify-content-center">',e+='               	<img src="'+i.thumb_file+'"  data-cid="'+i.clip_id+'" data-paid_yn="'+i.paid_yn+'" data-org_file="'+i.save_file+'" style=" height: 88px" class="'+o+' canvas-img " data-w="'+i.img_w+'" data-h="'+i.img_h+'" alt="" />',e+="            	</span>","Y"===i.paid_yn&&"N"===paid_user&&(e+='				<span><img class="paid-mark position-absolute"  src="/img/paid_mark.png" alt="유료마크" /></span>'),e+="            </a>"}),e+=' 				<div class="list-ignore d-none align-items-center justify-content-end" style="cursor: pointer" onclick="setSearchText(\''+i.title+"')\"><a>더보기</a></div>",e+="            </div>",e+="        </div>",e+="    </div>",e+='    <button class="image-prev"> <i class="fa-solid fa-angle-left"></i> </button>',e+='    <button class="image-next"> <i class="fa-solid fa-angle-right"></i> </button>',e+="</div>"}):"_upload"===t?(i.maxRowsCount=0,$.each(a,function(a,t){e+="<a>",e+='	<img src="'+t.image_file+'"  data-mid="'+t.myimg_id+'" data-org_file="'+t.image_file+'" data-paid_yn="N" data-w="'+t.w+'" data-h="'+t.h+'" class="objItemImg objItemImgMy canvas-img" />',e+='	<span class="myimg-delete" onclick="myupload_delete(\''+t.myimg_id+"');\">",e+='		<img src="/img/canvas_myimg_del.png" alt="" />',e+="	</span>",e+="</a>"})):$.each(a,function(a,t){e+='<div class="contents-list-wrap position-relative">',e+='    <p class="d-flex justify-content-between">'+t.title+'<span class="d-inline-block d-flex align-items-center text-primary" style="font-size: 13px;cursor: pointer" onclick="setSearchText(\''+t.title+"')\">더보기</span></p>",e+='    <div class="overflow-hidden">',e+='        <div class="image-list" style="overflow: hidden;width: 100vw">',e+='            <div class="image-list-inner justified-gallery editor_imglistall">',$.each(t.templates,function(a,t){e+="            <a "+(n=0===a?'class="active"':"")+">",e+='                	<img src="'+t.thumb_file+'"  data-paid_yn="'+t.paid_yn+'" class="objItemTemplate canvas-img" data-idx="'+t.template_id+'"  alt="" />',"Y"===t.paid_yn&&"N"===paid_user&&(e+='					<span><img class="paid-mark position-absolute"  src="/img/paid_mark.png" alt="유료마크" /></span>'),e+="            </a>"}),e+='                <div class="list-ignore d-none align-items-center justify-content-end" style="cursor: pointer" onclick="setSearchText(\''+t.title+"')\"><a>더보기</a></div>",e+="            </div>",e+="        </div>",e+="    </div>",e+='    <button class="image-prev"> <i class="fa-solid fa-angle-left"></i> </button>',e+='    <button class="image-next"> <i class="fa-solid fa-angle-right"></i> </button>',e+="</div>"}),$(".contents-list-container").append(e),setTimeout(function(){$(".justified-gallery").justifiedGallery(i)},300),applyDrag()}function cancel_contents_lists(){$('input[name="search-text"]').val(""),$(".contents-list-wrap").toggle(),$(".result-list-wrap").toggle()}function dragging(a){parseInt(a.clientX)-73>260&&parseInt(a.clientX)-73<=500&&$(".contents-menu-wrap").css("width",parseInt(a.clientX)-73+"px")}function setStrokeWidth(){if(!0===$("#active-stroke").prop("checked")&&void 0!==curObj&&"textbox"===curObj[0].type){var a,t=(1>$('input[name="stroke-width"]').val()?1:$('input[name="stroke-width"]').val())/10*(curObj[0].get("scaleX")/10);t=t<1?1:t,curObj[0].set({strokeWidth:t}),oCanvas.renderAll(),onUpdate()}}function myupload_delete(a){confirm("선택하신 이미지를 삭제하시곘습니까?")&&$.ajax({url:"/Canvas/userUploadDelete",data:{_csrf:$('input[name="_csrf"]').val(),myImg_id:a},method:"post",dataType:"json",async:!1,success:function(a){a.msg&&alert(a.msg),a.success&&$('.icon-menu div[data-val="_upload"]').trigger("click")}})}$(document).on("keyup","#objLHVal",function(){var a=$(this).val();a>3?a=3:a<.2&&(a=.2),$(this).val(a),$("#objLH").val(a).trigger("change")}),$(document).on("keyup","#objCSVal",function(){var a=$(this).val();a>100?a=100:a<-100&&(a=-100),$(this).val(a),$("#objCS").val(a).trigger("change")}),$(document).on("click",".fontSizeUp",function(){var a=$('input[name="objFSize"]'),t=parseInt(a.val())+1;a.val(t).trigger("change")}),$(document).on("click",".fontSizeDown",function(){var a=$('input[name="objFSize"]'),t=parseInt(a.val())-1;a.val(t).trigger("change")}),$(document).on("click",".fontSizeList li",function(){var a=$(this).data("val");$('input[name="objFSize"]').val(a).trigger("change"),$(".fontSizeList").removeClass("d-flex").addClass("d-none")}),$(document).on("click",".mvScroll",function(){var a,t,e=parseInt($(this).data("idx"));"up"===$(this).data("act")?void 0!==aCanvas[a=e-1]&&""!==aCanvas[a]?$($('.canvas-page[data-idx="'+e+'"]')[0]).insertBefore('.canvas-page[data-idx="'+a+'"]'):console.log("첫 페이지입니다."):void 0!==aCanvas[a=e+1]&&""!==aCanvas[a]?$($('.canvas-page[data-idx="'+e+'"]')[0]).insertAfter('.canvas-page[data-idx="'+a+'"]'):console.log("마지막 페이지입니다.");var n=aCanvas[e];t=aCanvas[a],aCanvas[a]=n,aCanvas[e]=t,resetPageNo()}),$(document).on("click",".btnPageDel",function(a){if(a.stopImmediatePropagation(),confirm("이 페이지를 삭제할까요?\n\n※페이지 삭제는 되돌릴 수 없습니다.")){var t=$(this).data("idx");if($(".canvas-page[data-idx='"+t+"']").remove(),aCanvas[t]=null,nCanvasNo--,0===$(".canvas-wrap .canvas-page").length)addPage(),t=0;else{var e=[];$.each(aCanvas,function(a,t){null!=t&&e.push(t)}),t=e.length-1,aCanvas=e}resetPageNo(),setCanvas(t)}}),$(document).on("click",".btnPageCopy",function(a){a.stopImmediatePropagation();var t=parseInt($(this).data("idx"));null!=aCanvas[t]&&addPage(aCanvas[t].toDatalessJSON())}),$(document).on("click",".objBGImg",function(a){if(a.stopImmediatePropagation(),"Y"===$(this).data("paid_yn")&&"N"===paid_user)return paid_modal(),!1;save_log("L",0,0,$(this).data("cid")),setBackgroundImg($(this).data("org_file"))}),$(document).on("click",".objItemImg",function(a){if(a.stopImmediatePropagation(),"Y"===$(this).data("paid_yn")&&"N"===paid_user)return paid_modal(),!1;$(this).hasClass("objItemImgMy")||save_log("L",0,0,$(this).data("cid")),$(".dummy_img").attr("src",$(this).data("org_file"));var t=$(this);setTimeout(function(){addImage("object",t.get(0))},100)}),$(document).on("click",".objItemTemplate",function(a){if(a.stopImmediatePropagation(),"Y"===$(this).data("paid_yn")&&"N"===paid_user)return paid_modal(),!1;save_log("L",$(this).data("idx"),0,0);var t=$(this).data("idx");LoadPage("template",t,!1)}),$(document).on("click",".btnDelMyImg",function(a){if(a.stopImmediatePropagation(),confirm("이 이미지를 삭제할까요?")){var t=$(this).parents(".listItemImgMy");$.post("/_proc/procHelper.htm",{nIdx:$(this).attr("nIdx"),commitType:"remove_ezcvs_img_my"},function(a){"succ"==a.ret?t.fadeOut(200,function(){t.remove(),$(".objItemImgMy").length>0||$(".wrapMyImg").hide()}):alert(a.msg)},"json")}}),$(document).on("input","#objCS",function(a){a.stopImmediatePropagation(),$("#objCSVal").val($(this).val()),curObj[0].set("charSpacing",$(this).val()),oCanvas.renderAll(),onUpdate()}),$(document).on("change","#objCS",function(a){a.stopImmediatePropagation(),curObj[0].set("charSpacing",$(this).val()),oCanvas.renderAll(),onUpdate()}),$(document).on("input","#objLH",function(a){a.stopImmediatePropagation(),$("#objLHVal").val($(this).val()),curObj[0].set("lineHeight",$(this).val()),oCanvas.renderAll(),onUpdate()}),$(document).on("change","#objLH",function(a){a.stopImmediatePropagation(),curObj[0].set("lineHeight",$(this).val()),oCanvas.renderAll(),onUpdate()}),$(document).on("change",".objBC",function(a){a.stopImmediatePropagation(),setBackgroundColor($(this).val(),$("#bgAllAccept").prop("checked"))}),$(document).on("click",".title-save",function(a){a.preventDefault();var t=$(this).parent(),e=t.find("input").val();if(""===e)return alert("페이지 제목을 입력해주세요!"),!1;t.prev().html(e),$(this).parent().toggleClass("d-none").toggleClass("d-flex"),$(this).parent().prev().toggleClass("d-none").toggleClass("d-flex"),$(this).parent().parent().find("span:eq(0)").css("width","70px")}),$(document).on("click",".canvas-title-str",function(a){a.preventDefault(),$(this).toggleClass("d-none").toggleClass("d-flex"),$(this).next().toggleClass("d-none").toggleClass("d-flex"),$(this).parent().find("span:eq(0)").css("width","95px")}),$(document).on("click",".objItemTxt",function(a){a.stopImmediatePropagation(),addTxt()}),$(document).on("change",".upImgFile",function(a){a.stopImmediatePropagation();var t=$(this).val().split("."),e=t[t.length-1];"JPG"===(e=e.toUpperCase())||"PNG"===e||"GIF"===e||"JPEG"===e?($(this).attr("nIdx"),$("#frmImgUpload").submit()):alert("이미지 파일(JPG,PNG,GIF)만 등록가능합니다.")}),$(document).on("change",".objFSize",function(a){a.stopImmediatePropagation();var t=$(this).val();void 0!==curObj&&curObj[0]&&"textbox"==curObj[0].type&&(curObj[0].set("fontSize",t),oCanvas.renderAll(),onUpdate())}),$(document).on("keyup",".objFSize",function(a){a.stopImmediatePropagation();var t=$(this).val();curObj[0]&&"textbox"==curObj[0].type&&(curObj[0].set("fontSize",t),oCanvas.renderAll(),onUpdate())}),$(document).keydown(function(a){if(a.stopImmediatePropagation(),!1===isFontLoaded)return!1;if((curObj=oCanvas.getActiveObjects()).length)switch(a.keyCode){case 8:case 46:if(!0==$(":focus").is("input")||curObj[0].isEditing)return!0;curObj&&(curObj.forEach(function(a){oCanvas.remove(a)}),oCanvas.discardActiveObject(),oCanvas.renderAll(),onUpdate());break;case 37:curObj.forEach(function(a){a.set("left",a.get("left")-5)}),oCanvas.renderAll();break;case 38:curObj.forEach(function(a){a.set("top",a.get("top")-5)}),oCanvas.renderAll();break;case 39:curObj.forEach(function(a){a.set("left",a.get("left")+5)}),oCanvas.renderAll();break;case 40:curObj.forEach(function(a){a.set("top",a.get("top")+5)}),oCanvas.renderAll();break;case 67:event.ctrlKey&&procCopy(a),ret}switch(a.keyCode){case 90:event.ctrlKey&&unDo();break;case 89:event.ctrlKey&&reDo();break;case 86:event.ctrlKey&&procPaste(a);break;case 71:if(event.ctrlKey)return curObj.length>1?procSetGroup():procSetUnGroup(),!1}}),$(document).on("contextmenu",".cvBase",function(a){if(a.stopImmediatePropagation(),$(".objPopMenu").hide(),curObj=oCanvas.findTarget(a.originalEvent)){oCanvas.setActiveObject(curObj),oCanvas.renderAll();var t=oCanvas.getActiveObject(),e=oCanvas.getActiveObjects();$(".btnObject").show(),"group"==t.type?($(".btnGroup").hide(),$(".btnUnGroup").show()):e.length>1?($(".btnGroup").show(),$(".btnUnGroup").hide()):($(".btnGroup").hide(),$(".btnUnGroup").hide())}else $(".btnObject").hide();return $(".objPopMenu").css({left:a.clientX+10,top:a.clientY+5}).show(100),!1}),$(document).on("click",function(a){a.stopImmediatePropagation(),$(".objPopMenu").hide()}),$(document).on("click",".objFTA",function(a){a.stopImmediatePropagation(),curObj[0]&&"textbox"==curObj[0].type&&(curObj[0].set("textAlign",$(this).data("val")),oCanvas.renderAll(),onUpdate())}),$(document).on("click",".objFS",function(a){a.stopImmediatePropagation(),curObj[0]&&"textbox"==curObj[0].type&&("bold"==$(this).data("val")?$(this).hasClass("active")?(curObj[0].set("fontWeight","normal"),$(this).removeClass("editor_tstyle_onactive")):(curObj[0].set("fontWeight","800"),$(this).addClass("active")):"italic"==$(this).data("val")?$(this).hasClass("active")?(curObj[0].set("fontStyle","normal"),$(this).removeClass("active")):(curObj[0].set("fontStyle","italic"),$(this).addClass("active")):"underline"==$(this).data("val")?$(this).hasClass("active")?(curObj[0].set("underline",!1),$(this).removeClass("active")):(curObj[0].set("underline",!0),$(this).addClass("active")):"shadow"==$(this).data("val")&&($(this).hasClass("active")?(curObj[0].set({shadow:""}),$(this).removeClass("active")):(curObj[0].set({shadow:"rgba(0,0,0, 0.3) 2px 2px 2px"}),$(this).addClass("active"))),oCanvas.renderAll(),onUpdate())}),$(document).on("change",".objFC",function(a){a.stopImmediatePropagation(),void 0!==curObj&&curObj[0]&&"textbox"==curObj[0].type&&(curObj[0].set("fill",$(this).val()),oCanvas.renderAll(),onUpdate(),addRecentColor("text",$(this).val()))}),$(document).on("click",".objFC_p",function(a){a.stopImmediatePropagation(),$(".objFC").val(rgb2hex($(this).css("background-color"))),$(".objFC").trigger("change")}),$(document).on("change",".objFBC",function(a){a.stopImmediatePropagation(),void 0!==curObj&&curObj[0]&&"textbox"==curObj[0].type&&(curObj[0].set("textBackgroundColor",$(this).val()),oCanvas.renderAll(),onUpdate(),addRecentColor("bg",$(this).val()))}),$(document).on("click",".objFBC_p",function(a){a.stopImmediatePropagation();var t=rgb2hex($(this).css("background-color"));$(".objFBC").val(t),$(".objFBC").trigger("change")}),$(document).on("click",".objFBC_no",function(a){a.stopImmediatePropagation(),void 0!==curObj&&"textbox"===curObj[0].type&&(curObj[0].set("textBackgroundColor",""),oCanvas.renderAll(),onUpdate())}),$(document).on("change",".objFF",function(a){a.stopImmediatePropagation(),void 0!==curObj&&curObj[0]&&"textbox"===curObj[0].type&&(curObj[0].set("fontFamily",$(this).val()),oCanvas.renderAll(),onUpdate())}),$(document).on("click",".image-prev",function(){var a,t=0==$(this).parent().find(".image-list-inner > a.active").index(),e=$(this).parent().find(".image-list-inner > a.active");if(!0===t)return!1;e.removeClass("active").prev().addClass("active"),a="-"+$(this).parent().find(".image-list-inner > a.active").css("left"),$(this).parent().find(".image-list").css("transform","translateX("+a+")")}),$(document).on("click",".image-next",function(){var a,t=$(this).parent().find(".image-list-inner > a.active").index()+1==$(this).parent().find(".image-list-inner > a").length,e=$(this).parent().find(".image-list-inner > a.active");if(!0===t)return!1;e.removeClass("active").next().addClass("active"),a="-"+$(this).parent().find(".image-list-inner > a.active").css("left"),$(this).parent().find(".image-list-inner > a.active").index()+1==$(this).parent().find(".image-list-inner > a").length&&$(this).parent().find(".image-list-inner div.list-ignore").removeClass("d-none").addClass("d-flex"),$(this).parent().find(".image-list").css("transform","translateX("+a+")")}),$(document).on("keyup",'input[name="search-text"]',function(a){a.preventDefault(),13===a.keyCode&&(setTextCancelIcon(),getList())}),$(function(){var a=0,t=["Nanum Gothic","Nanum Myeongjo","IM_HyeminRegular","GangwonEduAllLight","MaplestoryLight","Yangjin","Jalnan","ONE_MobilePOP","INKLIPQUID","GmarketSansTTFMedium","CookieRunRegular","TMONBlack","Black And White Picture","Black Han Sans","Cute Font","Dokdo","East Sea Dokdo","Dongle","Gaegu","Gamja Flower","Gowun Dodum","Gugi","Hahmlet","Hi Melody","Kirang Haerang","Nanum Pen Script","Nanum Brush Script","Poor Story","Single Day","Stylish","Yeon Sung","Do Hyeon","Jua","Sunflower"];dialog=$(".wrapProgress").dialog({autoOpen:!0,minHeight:120,dialogClass:"alert",open:function(a,t){$(".ui-dialog-titlebar-close",$(this).parent()).hide()}}),$("#progressbar").progressbar({value:!1,max:t.length,change:function(){$(".progress-label").text("진행 : "+$("#progressbar").progressbar("value")+" / "+t.length)},complete:function(){$(".progress-label").text("완료!")}}),WebFont.load({google:{families:t},loading:function(){},inactive:function(){},fontloading:function(){},fontactive:function(){a++,$("#progressbar").progressbar("value",a)},fontinactive:function(a){},active:function(){isFontLoaded=!0,$("#objLoading").fadeOut("fast",function(){dialog.dialog("close"),Init(),check_mobile()&&mobile_modal()})}}),setContentsWrap("_template"),$(".hide-contents").on("click",function(){$(".contents-menu-wrap").hasClass("wrap-disable")?$(".contents-menu-wrap").removeClass("wrap-disable"):$(".contents-menu-wrap").addClass("wrap-disable")}),$(".icon-menu-wrap > ul > li > div").on("click",function(){$(".icon-menu-wrap > ul > li > div").removeClass("active"),!1==$(this).hasClass("hide-contents-wrap")&&($(this).addClass("active"),setContentsWrap($(this).data("val")))}),$("#frmSave").ajaxForm({type:"post",dataType:"json",cache:!1,success:function(a,t){$(".btnSave").html("저장됨").addClass("disabled"),save_ing=!1,$('input[name="_csrf"]').val(a.csrf),"N"===$("#bg_save").val()?(a.msg&&alert(a.msg),a.success&&(opener.location.href="/My",window.close())):(parseInt(a.id)>0&&($('#frmSave input[name="my_canvas_id"]').val(a.id),$('#frmSave input[name="save_type"]').val("my")),$("#last_modified").val(a.datetime))}}),$(".close-object-wrap").on("click",function(){$(".contents-menu-wrap").addClass("d-flex").removeClass("d-none"),$(".object-wrap").removeClass("d-flex").addClass("d-none")}),$(".emRotate").on("click",function(){$(".emRotate").removeClass("active");var a=$(this).data("val");"S"==a?(nCanvasWidth=2200,nCanvasHeight=2200):"P"==a?(nCanvasWidth=1556,nCanvasHeight=2200):(nCanvasWidth=2200,nCanvasHeight=1556),procZoom(nCurZoom),$(this).addClass("active"),chkScroll()}),$(".canvas-scroll").scroll(chkScroll),$(".isDraw").on("click",function(a){a.stopImmediatePropagation(),$(this).prop("checked")?(oCanvas.isDrawingMode=!0,oCanvas.freeDrawingBrush.width=20,oCanvas.freeDrawingBrush.color=$(".objFC").val()):oCanvas.isDrawingMode=!1}),$(".header_logo").dblclick(function(a){a.stopImmediatePropagation(),oCanvas.renderAll()}),$(".btnDownload").on("click",function(a){a.stopImmediatePropagation(),"down"!==act&&(loader("다운로드 준비 중 입니다."),console.log("in btnDownload Called loader")),oCanvas.discardActiveObject(),oCanvas.renderAll();var t=nCurZoom;procZoom(1,!0);var e=[];$(".canvas-page").each(function(){var a=$(this).data("idx");if(parseInt(a)>=0&&null!=aCanvas[a]){var t=aCanvas[a].toDataURL();e.push(t)}}),procZoom(t),$("#aImgData").val(JSON.stringify(e)),$("#frmDown").submit(),setTimeout(loader,500)}),$(".btnSlide").on("click",function(a){a.stopImmediatePropagation(),oCanvas.discardActiveObject(),oCanvas.renderAll();var t=nCurZoom;procZoom(1,!0);var e=[];$(".canvas-page").each(function(){var a=$(this).data("idx");if(parseInt(a)>=0&&null!=aCanvas[a]){var t=aCanvas[a].toDataURL();e.push(t)}}),procZoom(t),$("#aSlideData").val(JSON.stringify(e));var n=$(window).width(),o=$(window).height();window.open("","winSlide","width="+n+",height="+o+",left=0,top=0,resizable=no,fullscreen=yes"),$("#frmSlide").attr("target","winSlide"),$("#frmSlide").attr("action","/Canvas/Slide"),$("#frmSlide").submit()}),$(".btnSave").on("click",function(a){a.stopImmediatePropagation(),oCanvas.discardActiveObject(),oCanvas.renderAll(),save_process()}),$(".btnObjBG").on("click",function(a){a.stopImmediatePropagation();var t=$(this).attr("val");$(".btnObjBG").removeClass("editor_tooltab_btnon").addClass("editor_tooltab_btnoff"),$(this).removeClass("editor_tooltab_btnoff").addClass("editor_tooltab_btnon"),$(".right_top").hide(),$(".right_top_"+t).show(),$(".right_obj").hide(),$(".right_bg").hide(),$(".right_"+t).show(),$("#frmSearch").attr("val",t),$(".btnSearchClose").trigger("click"),oCanvas.discardActiveObject(),oCanvas.renderAll(),onUpdate()}),$(".btnSearchClose").on("click",function(a){a.stopImmediatePropagation(),$(this).hide(),$("#txtKeyword").val("");var t=$("#frmSearch").attr("val");$(".right_"+t+"_search_result").html(""),$(".right_"+t+"_search").hide(),$(".right_"+t+"_def").show()}),$(".btnMoreItem").on("click",function(a){a.stopImmediatePropagation();var t=$(this).parents(".editor_imglisttlt").siblings(".wrapItemList");"block"==t.css("display")?(t.css({height:"117px",display:"flex"}),$(this).html("더보기")):(t.css({height:"auto",display:"block"}),$(this).html("접기"))}),$(".btnPageAdd").on("click",function(a){a.stopImmediatePropagation(),addPage()}),$(".btnUnDo").on("click",function(a){a.stopImmediatePropagation(),unDo()}),$(".btnReDo").on("click",function(a){a.stopImmediatePropagation(),reDo()}),$(".btnZoomOut").on("click",function(a){a.stopImmediatePropagation();var t=parseFloat(nCurZoom);if(t<=.3)return!1;procZoom(t=Math.round((t-.1)*1e12)/1e12)}),$(".btnZoomIn").on("click",function(a){a.stopImmediatePropagation();var t=parseFloat(nCurZoom);if(t>=1.3)return!1;procZoom(t=Math.round((t+.1)*1e12)/1e12)}),$(".objDelete").on("click",function(a){a.stopImmediatePropagation(),procDelete()}),$(".btnCT").on("mouseover",function(a){a.stopImmediatePropagation(),$(this).css({"background-color":"#003399",color:"#fff"})}),$(".btnCT").on("mouseout",function(a){a.stopImmediatePropagation(),$(this).css({"background-color":"#fff",color:"#000"})}),$(".btnCT").on("click",function(a){a.stopImmediatePropagation();var t=$(this).attr("cmd");"delete"==t?procDelete():"forward"==t?procForward():"forwardFirst"==t?procForwardFirst():"backward"==t?procBackward():"backwardLast"==t?procBackwardLast():"flipX"==t?procFlipX():"flipY"==t?procFlipY():"rotate90"==t?procRotate(90):"rotate180"==t?procRotate(180):"group"==t?procSetGroup():"ungroup"==t?procSetUnGroup():"copy"==t?procCopy():"paste"==t&&procPaste()}),$(".btnAlign").on("click",function(a){a.stopImmediatePropagation();var t=$(this).data("val");"left"==t?procAlignLeft():"center"==t?procAlignCenter():"right"==t?procAlignRight():"forward"==t?procForward():"backward"==t?procBackward():"flipX"==t?procFlipX():"flipY"==t?procFlipY():"rotate90"==t?procRotate(90):"rotate180"==t&&procRotate(180)}),"down"===act&&(downloadInterval=setInterval(function(){!0===completeRemakePage&&(clearInterval(downloadInterval),loader("다운로드 준비 중 입니다."),setTimeout(function(){$(".btnDownload").click()},500))},500)),$('input[name="top_title"]').on("blur",function(){""!==$(this).val()&&(oCanvas.discardActiveObject(),oCanvas.renderAll(),save_process("bg-save"))})}),$(document).on("click",".curr-copy",function(){$("#save_type").val("new");var a=$('input[name="top_title"]');a.val(a.val()+" - 복사본"),$(".btnSave").click()}),$(document).on("click",".load-recent-data",function(){location.reload()}),$(document).on("change","#active-stroke",function(){void 0!==curObj&&"textbox"===curObj[0].type?!0===$(this).prop("checked")?(!1==$("#accordionStroke .accordion-collapse").hasClass("show")&&$('.accordion-button[aria-controls="stroke-wrap"]').trigger("click"),$('input[name="stroke-width-range"]').trigger("change")):(curObj[0].set({stroke:null,strokeWidth:null}),oCanvas.renderAll(),onUpdate()):$(this).prop("checked",!1)}),$(document).on("change",'input[name="stroke-width-range"]',function(){if($('input[name="stroke-width"]').val($(this).val()).trigger("change"),void 0!==curObj&&curObj[0]&&"textbox"===curObj[0].type){$("#active-stroke").prop("checked",!0);var a=curObj[0].get("scaleX"),t=$('input[name="stroke-color"]').val(),e=$(this).val()/10*a;curObj[0].set({stroke:t,strokeWidth:e}),oCanvas.renderAll(),onUpdate()}}),$(document).on("keyup",'input[name="stroke-width"]',function(){if(void 0!==curObj&&"textbox"===curObj[0].type){$("#active-stroke").prop("checked",!0);var a=curObj[0].get("scaleX"),t=$('input[name="stroke-color"]').val(),e=$(this).val()/10*a;curObj[0].set({stroke:t,strokeWidth:e}),oCanvas.renderAll(),onUpdate()}}),$(document).on("change",'input[name="stroke-color"]',function(){if(void 0!==curObj&&curObj[0]&&"textbox"===curObj[0].type){$("#active-stroke").prop("checked",!0);var a=curObj[0].get("scaleX"),t=$(this).val(),e=$('input[name="stroke-width"]').val()/10*a;curObj[0].set({stroke:t,strokeWidth:e}),oCanvas.renderAll(),onUpdate()}}),$(document).on("change","#active-shadow",function(){void 0!==curObj&&curObj[0]&&"textbox"===curObj[0].type?!0===$(this).prop("checked")?(!1==$("#accordionShadow .accordion-collapse").hasClass("show")&&$('.accordion-button[aria-controls="shadow-wrap"]').trigger("click"),$('input[name="shadow-blur-range"]').trigger("change")):(curObj[0].set({shadow:null}),oCanvas.renderAll(),onUpdate()):$(this).prop("checked",!1)}),$(document).on("change",'input[name="shadow-blur-range"]',function(){if($('input[name="shadow-blur"]').val($(this).val()).trigger("change"),void 0!==curObj&&curObj[0]&&"textbox"===curObj[0].type){var a=$('input[name="shadow-color"]').val(),t=5,e=5,n=$(this).val(),o=$(".shadow-direct li.active");o.length>0?(e=o.data("y"),t=o.data("x")):$('.shadow-direct li[data-x="'+t+'"][data-y="'+e+'"]').addClass("active");var i=new fabric.Shadow({blur:n,color:a,offsetX:t,offsetY:e});curObj[0].set({shadow:i}),oCanvas.renderAll(),onUpdate()}}),$(document).on("keyup",'input[name="shadow-blur"]',function(){if(void 0!==curObj&&curObj[0]&&"textbox"===curObj[0].type){5>$(this).val()||$(this).val();var a=$('input[name="shadow-color"]').val(),t=5,e=5,n=$(this).val(),o=$(".shadow-direct li.active");o.length>0?(e=o.data("y"),t=o.data("x")):$('.shadow-direct li[data-x="'+t+'"][data-y="'+e+'"]').addClass("active");var i=new fabric.Shadow({blur:n,color:a,offsetX:t,offsetY:e});curObj[0].set({shadow:i}),oCanvas.renderAll(),onUpdate()}}),$(document).on("change",'input[name="shadow-color"]',function(){if(void 0!==curObj&&curObj[0]&&"textbox"===curObj[0].type){var a=$(this).val(),t=5,e=5,n=$('input[name="shadow-blur"]').val(),o=$(".shadow-direct li.active");o.length>0?(e=o.data("y"),t=o.data("x")):$('.shadow-direct li[data-x="'+t+'"][data-y="'+e+'"]').addClass("active");var i=new fabric.Shadow({blur:n,color:a,offsetX:t,offsetY:e});curObj[0].set({shadow:i}),oCanvas.renderAll(),onUpdate()}}),$(document).on("click",".shadow-direct li",function(){if(void 0!==curObj&&curObj[0]&&"textbox"===curObj[0].type){var a=null,t=$(this).hasClass("active");if($(".shadow-direct li").removeClass("active"),!1===t){var e=$(this).data("x"),n=$(this).data("y"),o=$('input[name="shadow-color"]').val(),i=$('input[name="shadow-blur"]').val();$(this).addClass("active"),a=new fabric.Shadow({color:o,blur:i,offsetX:e,offsetY:n})}curObj[0].set({shadow:a}),oCanvas.renderAll(),onUpdate()}});